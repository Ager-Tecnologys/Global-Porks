<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Usuário</title>
    <script src="../js/funcoes.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="../../favicon.ico">
</head>

<body>

    <div class="header">
        <div class="container">
            <div class="container logo">
                <img src="imgs/Ager-recolor.png" />
                <h1>AGER Technologies</h1>
            </div>
            <ul>
                <li><a href="../index.html#aboutUs">Sobre nós</a></li>
                <li><a href="../Simulador_Financeiro/Simulador.html">Orçamento</a></li>
                <li><a href="../Produtos/Produtos.html">Produtos</a></li>
                <li><a href="../Login/Tela-login.html">Entrar</a></li>
            </ul>
            <a class="btnCadastro" href="../Cadastro/CadastroEmpresa.html#idBanner">Cadastrar-se</a>
        </div>
    </div>

    <div id="id_modal" class="modal">
        <div id="id_content" class="content">

            <header class="modalHeader">
                <h2 id="titleErro">Erro!</h2>
            </header>
            <div class="container">
                <p id="erroDesc"></p>
            </div>

            <footer class="modalFooter">
                <button class="btn-fechar" onclick="fechar()">Fechar</button>
            </footer>
        </div>
    </div>

    <div id="idBanner" class="banner">
        <div class="alerta_erro">
            <div class="card_erro" id="cardErro">
                <span id="mensagem_erro"></span>
            </div>
        </div>
        <div class="container">
            <h2 style="margin-block-end: 30px;">Cadastre sua Empresa</h2>
            <div id="cad1" class="cont">
                <div class="wrap single">
                    <span>Razão Social:</span>
                    <input type="text" id="razao_social_input" placeholder="Insira a razão social">
                </div>
                <div class="wrap single">
                    <span>Nome Fantasia:</span>
                    <input type="text" id="nome_fantasia_input" placeholder="Insira o nome fantasia">
                </div>
                <div class="wrap single">
                    <span>CNPJ:</span>
                    <input type="text" id="cnpj_input" placeholder="Ex: 32960690000117">
                </div>
                <div class="wrap single">
                    <span>Telefone:</span>
                    <input type="text" id="telefone_input" placeholder="Ex: 1120187758">
                </div>
                <div class="wrap single">
                    <span>CEP:</span>
                    <input type="text" id="cep_input" placeholder="Ex: 13630-050">
                </div>
                <div class="wrap btn">
                    <button onclick="change()">Próximo</button>
                </div>
            </div>

            <div id="cad2" class="cont second">
                <div class="wrap single">
                    <span>Rua:</span>
                    <input type="text" id="rua_input" placeholder="Insira a sua rua.">
                </div>
                <div class="wrap single">
                    <span>Número:</span>
                    <input type="text" id="numero_input" placeholder="Insira o seu número.">
                </div>
                <div class="wrap single">
                    <span>Bairro:</span>
                    <input type="text" id="bairro_input" placeholder="Insira o seu bairro.">
                </div>
                <div class="wrap single">
                    <span>Cidade:</span>
                    <input type="text" id="cidade_input" placeholder="Insira a sua cidade">
                </div>
                <div class="wrap single">
                    <span>Estado:</span>
                    <select id="estado_input">
                        <option value="AC">Acre</option>
                        <option value="AL">Alagoas</option>
                        <option value="AP">Amapá</option>
                        <option value="AM">Amazonas</option>
                        <option value="BA">Bahia</option>
                        <option value="CE">Ceará</option>
                        <option value="DF">Distrito Federal</option>
                        <option value="ES">Espírito Santo</option>
                        <option value="GO">Goiás</option>
                        <option value="MA">Maranhão</option>
                        <option value="MT">Mato Grosso</option>
                        <option value="MS">Mato Grosso do Sul</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PA">Pará</option>
                        <option value="PB">Paraíba</option>
                        <option value="PR">Paraná</option>
                        <option value="PE">Pernambuco</option>
                        <option value="PI">Piauí</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="RN">Rio Grande do Norte</option>
                        <option value="RS">Rio Grande do Sul</option>
                        <option value="RO">Rondônia</option>
                        <option value="RR">Roraima</option>
                        <option value="SC">Santa Catarina</option>
                        <option value="SP">São Paulo</option>
                        <option value="SE">Sergipe</option>
                        <option value="TO">Tocantins</option>
                        <option value="EX">Estrangeiro</option>
                    </select>
                </div>
                <div class="wrap btn">
                    <button onclick="voltar()">Retornar</button>
                    <button onclick="change2()">Próximo</button>
                </div>
            </div>
            <!-- Div cadastro de usuário -->
            <div id="cad3" class="cont third"> 
                <div class="wrap">
                    <span>Nome:</span>
                    <input type="text" id="nome_usuario_input">
                </div>
                <div class="wrap">
                    <span>Sobrenome:</span>
                    <input type="text" id="sobrenome_usuario_input">
                </div>
                <div class="wrap">
                    <span>E-mail:</span>
                    <input type="text" id="email_usuario_input">
                </div>
                <div class="wrap">
                    <span>CPF:</span>
                    <input type="text" id="cpf_usuario_input">
                </div>
                <div class="wrap">
                    <span>Telefone:</span>
                    <input type="text" id="tel_usuario_input">
                </div>
                <div class="wrap">
                </div>
                <div class="wrap">
                    <span>Senha:</span>
                    <input type="password" id="senha_input">
                </div>
                <div class="wrap">
                    <span>Confirmar Senha:</span>
                    <input type="password" id="confirmacao_senha_input">
                </div>
                <div class="wrap btn">
                    <button onclick="voltar2()">Voltar</button>
                    <button onclick="cadastrar()">Cadastrar</button>
                </div>
            </div>

        </div>

        <div class="container img">
            <img src="imgs/imgForm.png" alt="">
        </div>

    </div>

    <div class="footer">
        <div class="container">
            <div class="container logo">
                <h1>AGER Technologies</h1>
            </div>

            <div class="container middle">
                <button>Entrar</button>
                <ul>
                    <li>Informação</li>
                    <a href="../Suporte/Suporte.html"><li>Suporte</li></a>
                    <li>Termos de uso</li>
                </ul>
            </div>

            <div class="container socials">
                <img src="imgs/instagram.png" alt="" />
                <img src="imgs/facebook.png" alt="" />
                <img src="imgs/linkedin.png" alt="" />
            </div>
        </div>
    </div>

    <div id="div_aguardar"></div>

</body>

</html>

<script>

    // 1º tela
    var razaoSocialVar = 0;
    var nomeFantasiaVar = 0;
    var cnpjVar = 0;
    var telefoneVar = 0;
    var cepVar = 0;
    // 2º tela
    var ruaVar = 0;
    var numeroVar = 0;
    var bairroVar = 0;
    var cidadeVar = 0;
    var estadoVar = 0;
    // 3º tela
    var nomeUsuarioVar = 0;
    var sobrenomeUsuarioVar = 0;
    var emailUsuarioVar = 0;
    var cpfUsuarioVar = 0;
    var telUsuarioVar = 0;
    var tipoUsuarioVar = "ADM";
    var senhaVar = 0;
    var confirmacaoSenhaVar = 0;

    function change() {
        razaoSocialVar = razao_social_input.value;
        nomeFantasiaVar = nome_fantasia_input.value;
        cnpjVar = cnpj_input.value;
        telefoneVar = telefone_input.value;
        cepVar = cep_input.value;

        if (razaoSocialVar == "" ||
            nomeFantasiaVar == "" ||
            cnpjVar == "" ||
            telefoneVar == "" ||
            cepVar == "") {
            erroDesc.innerHTML = "Preencha todos os campos para continuar."
            id_modal.style.display = "block"

            return false;
        } else if (cnpjVar.length != 14) {
            erroDesc.innerHTML = "CNPJ inválido!"
            id_modal.style.display = "block"
        } else if (cepVar.length != 8) {
            erroDesc.innerHTML = "CEP inválido!"
            id_modal.style.display = "block"
        } else if (telefoneVar.length > 11 || telefoneVar.length < 10) {
            erroDesc.innerHTML = "Telefone Inválido!"
            id_modal.style.display = "block"
            return false;
        } else {
            cad1.style.opacity = "0"
            cad1.style.display = "none"
            cad2.style.display = "flex"
            setTimeout(() => { cad2.style.opacity = "1" }, 10)
        }
    }

    function change2() {
        ruaVar = rua_input.value;
        numeroVar = numero_input.value;
        bairroVar = bairro_input.value;
        cidadeVar = cidade_input.value;
        estadoVar = estado_input.value;

        if (
            ruaVar == "" ||
            numeroVar == "" ||
            bairroVar == "" ||
            cidadeVar == "" ||
            estadoVar == "") {

            erroDesc.innerHTML = "Preencha todos os campos para continuar."
            id_modal.style.display = "block"
            return false;
        } else {
            cad2.style.opacity = "0"
            cad2.style.display = "none"
            cad3.style.display = "flex"
            setTimeout(() => { cad3.style.opacity = "1" }, 10)
        }
    }

    function voltar() {
        cad2.style.opacity = "0"
        cad2.style.display = "none"
        cad1.style.display = "flex"
        setTimeout(() => { cad1.style.opacity = "1" }, 10)
    }

    function voltar2() {
        cad3.style.opacity = "0"
        cad3.style.display = "none"
        cad2.style.display = "flex"
        setTimeout(() => { cad2.style.opacity = "1" }, 10)
    }


    function cadastrar() {
        // 3º tela
        nomeUsuarioVar = nome_usuario_input.value;
        sobrenomeUsuarioVar = sobrenome_usuario_input.value;
        emailUsuarioVar = email_usuario_input.value;
        cpfUsuarioVar = cpf_usuario_input.value;
        telUsuarioVar = tel_usuario_input.value;
        senhaVar = senha_input.value;
        confirmacaoSenhaVar = confirmacao_senha_input.value;

        if (nomeUsuarioVar == "" ||
            sobrenomeUsuarioVar == "" ||
            emailUsuarioVar == "" ||
            cpfUsuarioVar == "" ||
            telUsuarioVar == "" ||
            senhaVar == "" ||
            confirmacaoSenhaVar == "" ||
            tipoUsuarioVar == ""
            ) {
            erroDesc.innerHTML = "Preencha todos os campos para continuar."
            id_modal.style.display = "block"


            return false;
        } else if (emailUsuarioVar.indexOf("@") == -1) {
            erroDesc.innerHTML = "E-Mail Inválido!"
            id_modal.style.display = "block"

            return false;
        } else if (senhaVar != confirmacaoSenhaVar) {
            erroDesc.innerHTML = "As senhas inseridas devem ser iguais para prosseguir!"
            id_modal.style.display = "block"

            return false;
            } else if (cpfUsuarioVar.length != 11) {
                erroDesc.innerHTML = "CPF inválido!"
                id_modal.style.display = "block"

                return false;
            } else if (telUsuarioVar.length > 11 || telUsuarioVar.length < 10) {
            erroDesc.innerHTML = "Telefone do usuário Inválido!"
            id_modal.style.display = "block"

            return false;
        } else {
            fetch("/empresas/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // 1º tela
                    razaoSocialServer: razaoSocialVar,
                    nomeFantasiaServer: nomeFantasiaVar,
                    telefoneServer: telefoneVar,
                    cnpjServer: cnpjVar,        
                    cepServer: cepVar,
                    // 2º tela
                    ruaServer: ruaVar,
                    numeroServer: numeroVar,
                    bairroServer: bairroVar,
                    cidadeServer: cidadeVar,
                    estadoServer: estadoVar,
                    // 3° tela
                    nomeUsuarioServer: nomeUsuarioVar,
                    sobrenomeUsuarioServer: sobrenomeUsuarioVar,
                    emailUsuarioServer: emailUsuarioVar,
                    cpfUsuarioServer: cpfUsuarioVar,
                    telUsuarioServer: telUsuarioVar,
                    senhaServer: senhaVar,
                    tipoUsuarioServer: tipoUsuarioVar
                })
            }).then(function (resposta) {
                
                console.log("resposta: ", resposta);
                
                if (resposta.ok) {
                    titleErro.innerHTML = "Sucesso!"
                    erroDesc.innerHTML = "Cadastro realizado com sucesso!"
                    id_modal.style.display = "block"
                    setTimeout(() => { window.location = "../Login/Tela-login.html"; }, 3000)
                    return limparFormulario();
                } else {
                    titleErro.innerHTML = "Erro!"
                    erroDesc.innerHTML = `Não foi possível realizar seu cadastro<br> ${resposta}`
                    id_modal.style.display = "block"
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                
            });
            return false;
        }
    }

    function fechar() {
        id_modal.style.display = "none"
    }

    // nomeUsuarioServer: nomeUsuarioVar,
    //                 sobrenomeUsuarioServer: sobrenomeUsuarioVar,
    //                 emailUsuarioServer: emailUsuarioVar,
    //                 cpfUsuarioServer: cpfUsuarioVar,
    //                 telUsuarioServer: telUsuarioVar,
    //                 senhaServer: senhaVar,
    //                 tipoUsuarioServer: tipoUsuarioVar

    // Rodar após resposta do cadastroUsuario
</script>